gcloud enable api container.googleapis.com

gcloud container clusters create cluster \
    --enable-master-authorized-networks \
    --network network \
    --subnetwork us-central-subnet \
    --cluster-secondary-range-name pods \
    --services-secondary-range-name services \
    --enable-private-nodes \
    --enable-ip-alias \
    --master-ipv4-cidr 172.16.0.0/28 \
    --no-enable-basic-auth \
    --no-issue-client-certificate \
    --service-account=kubernetes@triggering-a-198-4162dc2d.iam.gserviceaccount.com \
    --region=us-central1 \
    --num-nodes=2 \
    --machine-type=n1-standard-1



# Authorize a range
gcloud container clusters update private-cluster-2 \
    --enable-master-authorized-networks \
    --master-authorized-networks 10.4.0.0/20

#authorize cloud shell
dig +short myip.opendns.com @resolver1.opendns.com


gcloud container clusters update private-cluster-1 \
    --enable-master-authorized-networks \
    --master-authorized-networks EXISTING_AUTH_NETS,SHELL_IP/32


EXISTING_AUTH_NETS: the IP addresses of your existing list of authorized networks. You can find your authorized networks in the console or by running the following command:


gcloud container clusters describe private-cluster-1 --format "flattened(masterAuthorizedNetworksConfig.cidrBlocks[])"
SHELL_IP: the external IP address of your Cloud Shell.

gcloud container clusters get-credentials private-cluster-1 \
    --project PROJECT_ID

kubectl get nodes